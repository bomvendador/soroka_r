<?//Конфигурация$dbuname = 'u362675236_admin';$dbpass = '123456';$dbhost = 'mysql.hostinger.ru';$dbname = 'u362675236_class';function osc_genRandomPassword($length = 8){$dict = array_merge(range('a', 'z'), range('0', '9'), range('A', 'Z'));shuffle($dict);$pass = '';for($i = 0; $i < $length; $i++)$pass .= $dict[rand(0, count($dict) - 1)];return $pass;}$token = $_POST ["token"]; if (!$token) exit;$HTTP_HOST = $_SERVER['HTTP_HOST'];$s = file_get_contents("http://ulogin.ru/token.php?token=$token&host=$HTTP_HOST");$user = json_decode($s, true);$network = $user ["network"];$identity = $user ["identity"];$first_name = $user ["first_name"];$last_name = $user ["last_name"];$get_email = $user ["email"];$verified_email = $user ["verified_email"];$uid = $user ["uid"];if ($verified_email == 1); else die("Вы обязаны подтвержить Ваш E-Mail. Иначе регистрация не возможна");$identity = preg_replace("#[/W]#is", "", $identity);if (!$identity) die("identity NOT FOUND");$uid = preg_replace("#[/D]#is", "", $uid);if (!$uid) die("uid NOT FOUND");$dt_reg_date = date('Y-m-d H:i:s');$s_name = trim("$first_name $last_name");$s_secret = osc_genRandomPassword();$s_password = osc_genRandomPassword();$s_password_sha = sha1($s_password);if ($get_email) $s_email = $get_email;else $s_email = "{$identity}_{$uid}@$HTTP_HOST";$b_enabled = 1;$b_active = 1;$s_access_ip = "127.0.0.1";$sn_str = "{$identity}_{$uid}";mysql_connect($dbhost, $dbuname, $dbpass) or die ("Error");mysql_select_db($dbname);mysql_query("SET NAMES 'UTF8'");//Проверка на сущестовани мыла$q_data = mysql_query ("SELECT `pk_i_id`, `s_email`, `sn_pass` FROM `oc_t_user` WHERE `s_email`='$s_email'");$data_a = mysql_fetch_array($q_data);$pk_i_id = $data_a ["pk_i_id"];$post_email = $data_a ["s_email"];$post_pass = $data_a ["sn_pass"];//Мыла нет. проверка есть ли уже регаif (!$pk_i_id){$q_data = mysql_query ("SELECT `pk_i_id`, `s_email`, `sn_pass` FROM `oc_t_user` WHERE `sn_str`='$sn_str'");$data_a = mysql_fetch_array($q_data);$pk_i_id = $data_a ["pk_i_id"];$post_email = $data_a ["s_email"];$post_pass = $data_a ["sn_pass"];if (!$pk_i_id){mysql_query("INSERT INTO `oc_t_user`(`dt_reg_date`, `s_name`, `s_password`, `s_secret`, `s_email`, `b_enabled`, `b_active`, `dt_access_date`, `s_access_ip`, `sn_str`, `sn_pass`)VALUES('$dt_reg_date', '$s_name', '$s_password_sha', '$s_secret', '$s_email', '$b_enabled', '$b_active', '$dt_reg_date', '$s_access_ip', '$sn_str', '$s_password')");$mysql_id = mysql_insert_id();mysql_query("UPDATE `oc_t_user` SET `s_username`='$mysql_id' WHERE `pk_i_id`='$mysql_id'");$post_email = $s_email;$post_pass = $s_password;}}echo "<form name=\"subm_form\" action=\"/\" method=\"POST\"><input type=\"hidden\" name=\"post_em\" value=\"$post_email\" /><input type=\"hidden\" name=\"post_pass\" value=\"$post_pass\" /><input type=\"submit\" /></form><script type=\"text/javascript\">document.subm_form.submit();</script>";?>